<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>snake game</title>
    <style></style>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
    <h1>snake game</h1>
    <p>キーボードの↑↓→←で操作できます。</p>
    <button id="start-button">ゲーム開始</button>
    <button id="pause-button">一時中断</button>
    <button id="resume-button">再開</button>
    <canvas id="game-canvas" width="600px" height="400px"></canvas>
    <canvas id="ai-canvas" width="300px" height="500px"></canvas>
    <div class="control-container">
      <button id="up-btn" onclick="changeDirection('up')">▲</button>
      <div>
        <button id="left-btn" onclick="changeDirection('left')">◀</button>
        <button id="right-btn" onclick="changeDirection('right')">▶</button>
      </div>
      <button id="down-btn" onclick="changeDirection('down')">▼</button>
    </div>
    <script src="src.js"></script>
    <script src="../deeplearning/src.js"></script>
    <script>
function findMaxIndex(arr) {
  let maxIndex = 0;
  for (let i = 1; i < arr.length; i++) {
    if (arr[i] > arr[maxIndex]) {
      maxIndex = i;
    }
  }
  return maxIndex;
}

//初期設定
const Newron = [8,10, 4]
const learningRate = 0.01
let W = generateW(Newron)
let B = generateB(Newron)

function opField(){
  const dist = distance(snakeX, snakeY, foodX, foodY)
  const distanceToWall = getDistanceToWall(snakeX, snakeY, fieldX, fieldY)
  const prevDist = distance(prevSnakeX, prevSnakeY, foodX, foodY)
  
  let reward
  if (checkCollision()) {
    initGame()
    reward = 0.00001
  } else if(checkWall()) {
    initGame()
    reward = 0
  } else {
    reward = (30 - dist[2])*3.3/100
    
  }
  //食べ物1
  if (snakeX < foodX + foodSize &&
    snakeX + snakeSize > foodX &&
    snakeY < foodY + foodSize &&
    snakeY + snakeSize > foodY) {
    score += foodScore
    reward = 10
    snakeLength++
    spawnFood()
  }
  let upHead = 0;
  let downHead = 0;
  let rightHead = 0;
  let leftHead = 0;

  switch(direction) {
    case 'up':
      upHead = 1;
      break;
    case 'down':
      downHead = 1;
      break;
    case 'right':
      rightHead = 1;
      break;
    case 'left':
      leftHead = 1;
      break;
  }
  //const fieldArray = createFieldArray(fieldX, fieldY, snakeX, snakeY, foodX, foodY)
  //let Input = fieldArray
  let Input = [upHead,downHead,rightHead,leftHead,dist[0],dist[1],distanceToWall.x,distanceToWall.y]
  let output = NN(Input, W, B)
  let updated = updateNN(output.last, reward, output.x, W, B, learningRate)
  W = updated[0]
  B = updated[1]
  
console.log(W, B)
  const maxIndex = findMaxIndex(output.last)
  if (maxIndex === 0) {
    direction = 'up'
    
  } else if (maxIndex === 1) {
    direction = 'down'
    
  } else if (maxIndex === 2) {
    direction = 'right'
    
  } else if (maxIndex === 3) {
    direction = 'left'
    
  }
  drawNeuralNetwork(output.x, W, B, 'ai-canvas')
}
    </script>
  </body>
</html>